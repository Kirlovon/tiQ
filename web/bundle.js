!function(t){var e={};function o(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(s,r,function(e){return t[e]}.bind(null,r));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=1)}([function(t,e,o){var s,r,i;!function(a){if("object"==typeof t.exports){var n=a(o(2),e);void 0!==n&&(t.exports=n)}else r=[o,e],void 0===(i="function"==typeof(s=a)?s.apply(e,r):s)||(t.exports=i)}((function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VMError=e.VM=e.opcodes=void 0,e.opcodes={NOTHING:0,LOAD:1,SAVE:2,ADD:3,SUBSTRACT:4,EQUAL:5,LESS:6,GREATER:7,AND:8,OR:9,JUMP:10,TRUE:11,FALSE:12,RANDOM:13,INPUT:14,DISPLAY:15};e.VM=class{constructor(t={}){if(this.safe=!0,this.debug=!1,this.running=!1,this.counter=0,this.accumulator=0,this.memory=new Uint16Array(4096),this.display=new Uint8Array(1024),this.input=new Uint8Array(8),"object"!=typeof t)throw new o("Config must be an object");"boolean"==typeof t.safe&&(this.safe=t.safe),"boolean"==typeof t.debug&&(this.debug=t.debug)}start(){clearInterval(this.loop),this.running=!0,this.loop=setInterval(()=>this.step()),this.debug&&this.info("VM is started")}load(t){if(this.memory=new Uint16Array(4096),this.safe){if(t.length>4096)throw new o("Executable is too big and most likely broken");if(0===t.length)throw new o("Executable is empty and most likely broken");if(t[0]<4096)throw new o("Executable starts with an empty instruction and will not be executed")}for(let e=0;e<t.length;e++){const o=t[e];this.memory[e]=o}}reset(){this.counter=0,this.accumulator=0,this.memory=new Uint16Array(4096),this.display=new Uint8Array(1024),this.input=new Uint8Array(8),clearInterval(this.loop),this.debug&&this.info("VM is reseted")}stop(){this.running=!1,clearInterval(this.loop),this.debug&&this.info("VM is stopped")}step(){const t=this.fetch(this.counter),{opcode:e,argument:o}=this.decode(t);this.execute(e,o),this.counter+=1,this.counter>4095&&(this.counter=0)}fetch(t){return this.memory[t]}decode(t){let e=Math.floor(t/4096),s=Math.floor(t%4096);if(this.safe){if(e>15||e<0)throw new o("Invalid opcode");s>4095?(this.debug&&this.warn(`Argument was clamped from ${s} to "4095"`),s=4095):s<0&&(this.debug&&this.warn(`Argument was clamped from ${s} to "0"`),s=0)}return{opcode:e,argument:s}}execute(t,o){switch(t){case e.opcodes.NOTHING:this.running=!1,this.counter=0,this.accumulator=0,this.debug&&this.log("NOTHING, "+o);break;case e.opcodes.LOAD:this.accumulator=this.memory[o],this.debug&&this.log("LOAD, "+o);break;case e.opcodes.SAVE:this.memory[o]=this.accumulator,this.debug&&this.log("SAVE, "+o);break;case e.opcodes.ADD:{let t=this.accumulator+this.memory[o];this.safe&&t>65535&&(t=65535),this.accumulator=t,this.debug&&this.log("ADD, "+o);break}case e.opcodes.SUBSTRACT:{let t=this.accumulator-this.memory[o];this.safe&&t<0&&(t=0),this.accumulator=t,this.debug&&this.log("SUBSTRACT, "+o);break}case e.opcodes.EQUAL:this.accumulator=this.accumulator===this.memory[o]?1:0,this.debug&&this.log("EQUAL, "+o);break;case e.opcodes.LESS:this.accumulator=this.accumulator<this.memory[o]?1:0,this.debug&&this.log("LESS, "+o);break;case e.opcodes.GREATER:this.accumulator=this.accumulator>this.memory[o]?1:0,this.debug&&this.log("GREATER, "+o);break;case e.opcodes.AND:{const t=0===this.accumulator?0:1,e=0===this.memory[o]?0:1;this.accumulator=t&e,this.debug&&this.log("AND, "+o);break}case e.opcodes.OR:{const t=0===this.accumulator?0:1,e=0===this.memory[o]?0:1;this.accumulator=t|e,this.debug&&this.log("OR, "+o);break}case e.opcodes.JUMP:this.counter=o-1,this.safe&&this.accumulator<0&&(this.accumulator=0),this.debug&&this.log("JUMP, "+o);break;case e.opcodes.TRUE:0!==this.accumulator&&(this.counter=o-1),this.safe&&this.accumulator<0&&(this.accumulator=0),this.debug&&this.log("TRUE, "+o);break;case e.opcodes.FALSE:0===this.accumulator&&(this.counter=o-1),this.safe&&this.accumulator<0&&(this.accumulator=0),this.debug&&this.log("FALSE, "+o);break;case e.opcodes.RANDOM:this.accumulator=Math.floor(Math.random()*(o+1)),this.debug&&this.log("RANDOM, "+o);break;case e.opcodes.INPUT:{const t=this.input[o];this.accumulator=t?1:0,this.debug&&this.log("INPUT, "+o);break}case e.opcodes.DISPLAY:{const t=Math.floor(o/128),e=Math.floor(o%128),s=Math.floor(e/4),r=Math.floor(e%4),i=Math.floor(r/1),a=32*s+t;this.display[a]=i,this.debug&&this.log(`DISPLAY, ${t}, ${s}, ${i}`);break}}this.running||clearInterval(this.loop)}info(t){console.info(`tiQ [${Date.now()}]`,t)}log(t){console.log(`tiQ [${Date.now()}]`,t)}warn(t){console.warn(`tiQ [${Date.now()}]`,t)}};class o extends Error{constructor(t,e){super(t),this.name="VMError",Error.captureStackTrace(this,o),this.message=t,e&&(this.cause=e),"string"!=typeof e&&"number"!=typeof e||(this.message=`${t}: ${e}`)}}e.VMError=o}))},function(t,e,o){"use strict";o.r(e);var s=o(0);const r=new s.VM({debug:!0,safe:!0}),i=document.getElementById("display"),a=i.getContext("2d");function n(){for(let t=0;t<i.height;t++)for(let e=0;e<i.width;e++){const o=32*t+e,s=0!==r.display[o];a.fillStyle=s?"#ffffff":"#111111",a.fillRect(e,t,1,1)}r.running&&requestAnimationFrame(n)}a.imageSmoothingEnabled=!1,window.addEventListener("keydown",t=>{switch(t.code){case"ArrowUp":r.input[0]=1;break;case"ArrowDown":r.input[1]=1;break;case"ArrowLeft":r.input[2]=1;break;case"ArrowRight":r.input[3]=1;break;case"KeyZ":r.input[4]=1;break;case"KeyX":r.input[5]=1}}),window.addEventListener("keyup",t=>{switch(t.code){case"ArrowUp":r.input[0]=0;break;case"ArrowDown":r.input[1]=0;break;case"ArrowLeft":r.input[2]=0;break;case"ArrowRight":r.input[3]=0;break;case"KeyZ":r.input[4]=0;break;case"KeyX":r.input[5]=0}}),document.getElementById("load").addEventListener("click",async t=>{const e=await new Promise((t,e)=>{const o=document.createElement("input");o.type="file",o.onchange=e=>{t(e.target.files[0])},o.click()}),o=await(s=e,new Promise((t,e)=>{const o=new FileReader;o.readAsArrayBuffer(s),o.onload=e=>{const o=new Uint16Array(e.target.result);t(o)}}));var s;r.load(o),r.start(),n()}),document.getElementById("reset").addEventListener("click",()=>{r.stop(),r.reset(),a.clearRect(0,0,i.width,i.height)}),document.getElementById("start").addEventListener("click",()=>{r.start(),n()}),document.getElementById("stop").addEventListener("click",()=>{r.stop(),n()}),document.getElementById("step").addEventListener("click",()=>{r.step(),n()})},function(t,e){function o(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}o.keys=function(){return[]},o.resolve=o,t.exports=o,o.id=2}]);